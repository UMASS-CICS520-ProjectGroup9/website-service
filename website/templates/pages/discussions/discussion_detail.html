{% extends '../../base_components/main.html' %}
{% block content %}
<div
    style="width: 100vw; min-height: 80vh; background: #fff; box-shadow: 0 2px 12px rgba(0,0,0,0.07); border-radius: 0; padding: 3.5rem 6vw 3.5rem 6vw;">
    <a href="{% url 'discussions' %}" style="text-decoration: none; color: #3498db; font-size: 1.1rem;">&larr; Back to
        discussions</a>
    <h2 style="margin: 2rem 0 1.2rem 0; font-weight: 800; font-size: 2.6rem; letter-spacing: 0.01em;">
        {{discussion.title }}</h2>
    <div style="color: #888; font-size: 1.15rem; margin-bottom: 2.2rem;">
        <span>By <strong>{{ discussion.author }}</strong></span>
        &nbsp;|&nbsp;
        <span>
            {% if discussion.created_at_display %}
            {{ discussion.created_at_display }}
            {% else %}
            {{ discussion.created_at|date:'Y-m-d H:i' }}
            {% endif %}
        </span>
    </div>
    <div style="font-size: 1.35rem; line-height: 2.1; color: #222; margin-bottom: 2.5rem;">
        {{ discussion.body }}
    </div>
    {% if authen.is_login and authen.user_id and discussion.creator_id and authen.user_id == discussion.creator_id %}
    <div style="margin: 1rem 0 2rem 0;">
        <a href="/discussions/remove/{{ discussion.id }}/"
            style="background:#e74c3c; color:#fff; padding:0.6rem 1rem; border-radius:4px; text-decoration:none;">Delete
            Discussion</a>
    </div>
    {% endif %}
    <hr style="margin: 2.5rem 0; border: none; border-top: 1px solid #eee;" />
    <section>
        <h3 style="font-size:1.8rem; margin-bottom:1.2rem; font-weight:700;">Comments ({{ comments|length }})</h3>
        {% if comments %}
        <ul style="list-style:none; padding:0; margin:0; display:grid; gap:1.25rem;">
            {% for c in comments %}
            <li style="background:#fafafa; border:1px solid #e5e5e5; border-radius:8px; padding:1rem 1.2rem;">
                <div style="font-size:0.9rem; color:#777; margin-bottom:0.4rem;">
                    <strong>{{ c.author }}</strong>
                    <span style="color:#bbb">&middot;</span>
                    <span>{{ c.created_at_display|default:'Just now' }}</span>
                    {% if authen.is_login and authen.user_id and c.creator_id and authen.user_id == c.creator_id %}
                    <span style="margin-left:0.75rem;">
                        <a href="/discussions/comment/remove/{{ c.id }}/"
                            style="color:#e74c3c; text-decoration:none;">Delete</a>
                    </span>
                    {% endif %}
                </div>
                <div style="font-size:1.05rem; line-height:1.55;">{{ c.body }}</div>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p style="color:#888; font-style:italic;">No comments yet. Be the first to comment.</p>
        {% endif %}
    </section>
    <hr style="margin: 2.5rem 0; border: none; border-top: 1px solid #eee;" />
    <section>
        <h3 style="font-size:1.6rem; margin-bottom:1rem; font-weight:700;">Add a comment</h3>
        <form method="post" action="{% url 'discussion_comment_create' discussion.id %}">
            {% csrf_token %}
            <div style="display:flex; gap:1rem; align-items:flex-start; margin-bottom:1rem;">
                {% if authen.is_login %}
                <input name="author" type="hidden" value="{{ authen.user_id }}" readonly
                    style="flex:0 0 200px; padding:0.8rem; border:1px solid #e5e5e5; border-radius:4px;" />
                {% endif %}
                <textarea name="body" placeholder="Write your comment..." rows="1"
                    style="flex:1; padding:0.8rem; border:1px solid #e5e5e5; border-radius:4px;"></textarea>
                <button type="submit"
                    style="background:#ffffff; color:#fff; padding:0.1rem 1rem; border:none; border-radius:4px;">Post
                    Comment</button>
            </div>
        </form>
    </section>
</div>
{% endblock %}